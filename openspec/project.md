# Project Context

## Purpose
这是一个图片压缩工具，用于压缩图片文件，减少图片文件的大小，提高图片加载速度。支持压缩 JPEG、PNG、GIF 等所有兼容图片格式。

## Tech Stack
- Python 3.14 - 主要开发语言，务必使用 `pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple安` 从清华镜像安装依赖以提高下载速度
- Pillow (PIL) - 图像处理基础库
- numpy - 数值计算支持
- tinify - TinyPNG API客户端（高质量图片压缩）
- OpenCV (可选) - 高级图像处理功能
- scikit-image (可选) - 专业图像处理算法

## Project Conventions

### Code Style
- **遵循PEP 8标准** - 使用Python官方推荐的编码规范
- **缩进** - 4个空格，不使用Tab
- **行长度** - 每行不超过79个字符
- **命名约定**:
  - 变量和函数: `snake_case` (小写字母和下划线)
  - 类: `CamelCase` (首字母大写)
  - 常量: `UPPERCASE` (全大写)
  - 私有成员: `_leading_underscore` (前导下划线)
- **文件命名**: 全部小写，使用下划线分隔，如 `image_compressor.py`
- **注释**:
  - 模块级注释: 简明描述模块功能
  - 函数/类注释: 使用文档字符串(docstring)，遵循Google风格
  - 行内注释: 只在必要时添加，解释复杂逻辑
- **代码格式化工具**: 使用 `black` 和 `isort` 保持代码风格一致

### Architecture Patterns
- **模块化设计** - 将代码分为核心功能模块和辅助工具模块
  - `compressors/` - 不同类型图片的压缩算法实现
  - `utils/` - 工具函数和辅助方法
  - `models/` - 数据模型和配置类
  - `cli/` - 命令行接口
- **依赖注入** - 使用依赖注入模式简化测试和组件替换
- **策略模式** - 为不同图片格式和压缩算法实现策略模式
- **单例模式** - 对于资源密集型的组件（如图像处理引擎）使用单例模式
- **适配器模式** - 适配不同的外部库和API

### Testing Strategy
- **单元测试** - 使用 `pytest` 测试各个模块的独立功能
  - 覆盖率目标: 至少80%
  - 重点测试边界条件和错误处理
- **集成测试** - 测试模块间的交互
  - 测试完整的压缩流程
  - 验证与外部库的集成
- **性能测试** - 测量压缩效率和资源使用
  - 对比不同压缩算法的性能
  - 测试大文件和批量处理场景
- **回归测试** - 确保现有功能在修改后保持正常
- **测试自动化** - 使用CI/CD流程自动运行测试套件

### Git Workflow
- **分支策略** - 采用Git Flow工作流
  - `main` - 主分支，稳定版本
  - `develop` - 开发分支，集成所有功能
  - `feature/*` - 新功能开发分支
  - `bugfix/*` - 错误修复分支
  - `release/*` - 发布准备分支
  - `hotfix/*` - 生产环境紧急修复分支
- **提交规范** - 使用语义化提交格式
  - `feat: 添加新功能描述` - 新功能
  - `fix: 修复bug描述` - 错误修复
  - `docs: 更新文档` - 文档修改
  - `style: 代码风格调整` - 不影响功能的修改
  - `refactor: 代码重构` - 不添加新功能的代码改变
  - `test: 添加或更新测试` - 测试相关更改
  - `chore: 构建/配置更改` - 构建过程或辅助工具的变动
- **代码审查** - 所有PR必须经过至少一次代码审查才能合并
- **CI/CD集成** - 每次提交自动运行测试和代码质量检查

## Domain Context
- **图片格式知识**:
  - JPEG - 有损压缩，适用于照片类图像
  - PNG - 无损压缩，支持透明度，适用于图形和图标
  - GIF - 有限的颜色调色板，支持动画
  - WebP - 现代图像格式，提供更好的压缩率
  - AVIF - 新一代图像格式，提供更高压缩率
- **压缩技术**:
  - 有损压缩 - 通过删除部分数据来减小文件大小
  - 无损压缩 - 在不损失数据的情况下减小文件大小
  - 分辨率调整 - 通过降低图像分辨率来减小文件大小
  - 元数据清理 - 移除图像中不必要的元数据
- **质量评估指标**:
  - 文件大小减少百分比
  - SSIM (结构相似性指数)
  - PSNR (峰值信噪比)
  - 人眼视觉质量评估
- **性能考量**:
  - 压缩速度 vs 压缩质量的权衡
  - 内存使用优化
  - 批处理效率

## Important Constraints
- **技术约束**:
  - Python 3.14+ 环境要求
  - 内存使用限制 - 处理大图片时控制内存占用
  - 支持的图像格式 - JPEG, PNG, GIF, WebP, AVIF
  - 支持的最大图像分辨率 - 10000x10000像素
- **性能要求**:
  - 批处理模式下每秒至少处理10张标准大小图片
  - 单张图片压缩时间不超过5秒
- **质量约束**:
  - 有损压缩默认质量设置为85%（可配置）
  - 确保压缩后图像质量视觉上可接受
- **安全要求**:
  - 处理过程中不保留敏感元数据
  - 不读取或处理潜在恶意图像文件
- **跨平台支持**:
  - 兼容Windows、macOS和Linux操作系统
  - 支持主流文件系统路径格式

## External Dependencies
- **图像处理库**:
  - Pillow (PIL) - 基础图像处理功能
  - numpy - 数值计算支持
- **第三方API**:
  - TinyPNG API - 用于高质量PNG/JPEG压缩
    - 需要API密钥配置
    - 有免费使用额度限制
- **可选高级库**:
  - OpenCV - 高级图像处理功能
  - scikit-image - 专业图像处理算法
- **开发工具**:
  - pytest - 测试框架
  - black - 代码格式化
  - isort - 导入语句排序
  - flake8 - 代码质量检查
  - mypy - 类型检查
- **CI/CD服务**:
  - GitHub Actions / GitLab CI - 自动化测试和部署
